<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>白饭</title>
<link rel="stylesheet" href="style.css" />
<script src='js/util.js'></script>
</head>
<body>
<header>
<h1>白饭</h1>
<nav id="J_nav"></nav>
<p id="global_msg">白白胖胖爱吃饭</p>
</header>
<script type="text/javascript" charset="utf-8">
	var config = {
		defaultOrder : 0,
		username : localStorage['username'],
		password : localStorage['password'],
		API : 'http://api2.fanfou.com/',
		isType : null,
		typeArr : ['friends_timeline', 'replies', 'direct_messages', 'favorites'],
		pageArr : [2,2,2,2]
	};
	config.urlArr = [
		config.API +'statuses/friends_timeline.json?format=html',
		config.API +'statuses/replies.json?format=html',
		config.API +'statuses/direct_messages.json?format=html',
		config.API +'statuses/favorites.json?format=html'
	];

//get default msg
window.onload = function(){
	verify();
	createNav();
	switchTimeline();
//			showStatusForm();
	window.onkeyup = function(e,i){
		if (config.isType !== null)  return;
		if(e.keyCode == 39) {
			switchTimeline('right');
		}else if(e.keyCode == 37) {
			switchTimeline('left');
		}else if(e.keyCode == 78) { // press n to create new msg form
			showStatusForm();
		}else if(e.keyCode == 27 || e.keyCode == 82) {
			e.stopPropagation();
			if (config.isType == true ) {
				var pop = document.getElementById('J_update');
				pop.parentNode.removeChild(pop);
				config.isType = false;
			}else {
				switchTimeline();
			}
		}else if(e.keyCode == 32) {
			config.timeline = 'join';
//			config.prototype.t.page = 2;

			sendReq({url : config.urlArr[config.defaultOrder]+'&page='+config.pageArr[config.defaultOrder]});	
		}
			config.pageArr[config.defaultOrder]++;
			console.log(config.pageArr);
	}
	document.onclick = function(e){
		e.stopPropagation();
		var el = e.target;
		if (el.getAttribute('class') == 'reply') {
			var li = el.parentNode.parentNode.parentNode;
				reply_id = li.getAttribute('data-id'),
				auth = li.getAttribute('data-user');
				msg = '@'+auth+' ';
			//	msg = '@'+auth+' '+li.getElementsByClassName('msg')[0].innerHTML;
			showStatusForm(reply_id, msg);
		}else if(el.getAttribute('class')== 'former') {
			var uid = el.href.replace(/http:\/\/fanfou.com\//g,'');
			console.log(uid);
			var _url = config.API+'statuses/user_timeline.json?id='+uid;
			sendReq({url:_url});
		}
	}
}

</script>
</body>
</html>
